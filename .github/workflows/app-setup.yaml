name: App Setup

on:  # yamllint disable-line rule:truthy
  workflow_call:
    inputs:
      OVERRIDE_NAME:
        required: false
        type: string
    outputs:
      NAME:
        value: ${{ jobs.app-setup.outputs.NAME  }}

jobs:

  app-setup:
    timeout-minutes: 1
    runs-on: ubuntu-latest
    outputs:
      NAME: ${{ steps.set-name.outputs.NAME }}
      PR_NAMESPACE: ${{ steps.set-name-pr-namespace.PR_NAMESPACE }}
    steps:

      - name: "Set Name"
        id: set-name
        env:
          OVERRIDE_NAME: ${{ inputs.OVERRIDE_NAME }}
        run: |
          NAME=${{ github.event.repository.name }}
          echo "OVERRIDE_NAME: ${OVERRIDE_NAME}"
          if [ -n "${OVERRIDE_NAME}" ]; then
            NAME=${{ inputs.OVERRIDE_NAME }}
          fi
          echo "::set-output name=NAME::${NAME}"

      - name: "Set Name for PR namespace"
        id: set-name-pr-namespace
        run: |
         echo "::set-output name=PR_NAMESPACE::pr-${{ inputs.NAME }}-${{ github.event.number }}"
